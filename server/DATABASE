Changes to the database
-----------------------

- changes " valuable" to "valuable" for 36,37,38.
- update mm_items set description = replace(description,
"http://www.karchan.org/","/") where description like "%karchan.org%";
- update mm_rooms set contents = replace(contents,
"http://www.karchan.org/","/") where contents like "%karchan.org%";
- added help for eyebrow command
- alter table mm_rooms add (area varchar(49) not null default "Main");    
- create table mm_area (area varchar(49) not null primary key, description
text not null, shortdesc varchar(255) not null, owner varchar(20) , creation
timestamp);
- insert into mm_area values("Main", "The Land of Karchan is split up onto
different areas. This is the main area, and the area that is used by new
characters for exploring and learning about the way the game works.", "The
Main Area of Karchan", "Karn", null);
- create table mm_log (creation timestamp not null, name varchar(20) not
null, message varchar(255) not null, primary key (creation, name, message));
- update mm_usertable set password=password(password)
- alter table mm_log add (addendum text);
- alter table mm_usertable alter alignment set default 8;
- update mm_usertable set alignment=8 where alignment=0;
- alter table mm_usertable alter movementstats set default 1000;
- update mm_usertable set movementstats=1000 where movementstats=0;
- CREATE TABLE mm_commands (
  id int(11) NOT NULL default '0',
  callable int(1) default 0,
  command varchar(255) NOT NULL,
  method_name varchar(52) NOT NULL,
  room int(11) NULL,
  owner varchar(20),
  creation timestamp,
  PRIMARY KEY  (id, command)
);
- CREATE TABLE mm_methods (
  name varchar(52) NOT NULL,
  src text NOT NULL,
  owner varchar(20),
  creation timestamp,
  PRIMARY KEY  (name)
);
// - mm_action
- CREATE TABLE mm_events (
  eventid int(11) NOT NULL,
  name varchar(32) NULL,
  month int(11) NOT NULL default '-1',
  dayofmonth int(11) NOT NULL default '-1',
  hour int(11) NOT NULL default '-1',
  minute int(11) NOT NULL default '-1',
  dayofweek int(11) NOT NULL default '-1',
  callable int(2) NOT NULL default '1',
  method_name varchar(52) NOT NULL,
  room int(11),
  owner varchar(20),
  creation timestamp,
  PRIMARY KEY  (eventid)
);
- create table mm_answers (name varchar(20) not null, question varchar(80)
not null, answer text not null, primary key(name, question));
- create table scratchpad (id int not null primary key, scratch longblob not
null,   owner varchar(20),
  creation timestamp);
- create table mm_commandlog (stamp timestamp not null, name varchar(20) not
null, command varchar(255) not null, primary key(stamp, name));
- alter table mm_events alter callable set default 0;
- alter table mm_admin add (email varchar(80) not null default "");
- alter table mm_items add (capacity int, isopenable int(1) not null default
0, keyid int, containtype int);
- alter table mm_usertable alter column race set default "human";
- ALTER TABLE mm_usertable MODIFY race enum('fox','zombie','wyvern','wolf','turtle','troll','spider','slug','ropegnaw','rabbit','orc','ooze','human','elf','dwarf','duck','deity','chipmunk',
'buggie','dragon') not null default "human";
- ALTER TABLE mm_usertable MODIFY sex enum('male','female')
not null default "male";
- ALTER TABLE mm_rooms MODIFY contents TEXT not null;
- ALTER TABLE characterinfo MODIFY storyline TEXT;
- ALTER TABLE mm_help MODIFY contents TEXT not null;
- ALTER TABLE mm_items MODIFY eatable TEXT;
- ALTER TABLE mm_items MODIFY drinkable TEXT;
- ALTER TABLE mm_items MODIFY description TEXT not null;
- ALTER TABLE mm_items MODIFY readdescr TEXT;
- ALTER TABLE mm_logonmessage MODIFY message TEXT not null;
- ALTER TABLE mm_mailtable MODIFY message TEXT not null;
ALTER TABLE bugs engine=InnoDB;
ALTER TABLE characterinfo engine=InnoDB;
ALTER TABLE family engine=InnoDB;
ALTER TABLE familyvalues engine=InnoDB;
ALTER TABLE links engine=InnoDB;
ALTER TABLE poll_choices engine=InnoDB;
ALTER TABLE poll_values engine=InnoDB;
ALTER TABLE polls engine=InnoDB;
ALTER TABLE scratchpad engine=InnoDB;

ALTER TABLE mm_admin engine=InnoDB;
ALTER TABLE mm_answers engine=InnoDB;
ALTER TABLE mm_area engine=InnoDB;
ALTER TABLE mm_bantable engine=InnoDB;
ALTER TABLE mm_boardmessages engine=InnoDB;
ALTER TABLE mm_boards engine=InnoDB;
ALTER TABLE mm_charattributes engine=InnoDB;
ALTER TABLE mm_charitemtable engine=InnoDB;
ALTER TABLE mm_commands engine=InnoDB;
ALTER TABLE mm_errormessages engine=InnoDB;
ALTER TABLE mm_events engine=InnoDB;
ALTER TABLE mm_help engine=InnoDB;
ALTER TABLE mm_itemattributes engine=InnoDB;
ALTER TABLE mm_itemitemtable engine=InnoDB;
ALTER TABLE mm_items engine=InnoDB;
ALTER TABLE mm_itemtable engine=InnoDB;
ALTER TABLE mm_log engine=InnoDB;
ALTER TABLE mm_logonmessage engine=InnoDB;
ALTER TABLE mm_mailtable engine=InnoDB;
ALTER TABLE mm_methods engine=InnoDB;
ALTER TABLE mm_roomattributes engine=InnoDB;
ALTER TABLE mm_roomitemtable engine=InnoDB;
ALTER TABLE mm_rooms engine=InnoDB;
ALTER TABLE mm_shopkeeperitems engine=InnoDB;
ALTER TABLE mm_sillynamestable engine=InnoDB;
ALTER TABLE mm_unbantable engine=InnoDB;
ALTER TABLE mm_usertable engine=InnoDB;
ALTER TABLE mm_bannednamestable engine=InnoDB;
- create table mm_bannednamestable (name varchar(20) not null primary key, 
deputy varchar(20),
creation timestamp not null,
days int(3), reason varchar(255));
- alter table mm_events
add foreign key (method_name) references mm_methods (name)
on delete restrict
on update cascade;
- alter table mm_commands
add foreign key (method_name) references mm_methods (name)
on delete restrict
on update cascade;
- alter table mm_itemtable
add foreign key (itemid) references mm_items (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (area) references mm_area (area)
on delete restrict
on update cascade;
- alter table mm_roomitemtable
add foreign key (id) references mm_itemtable (id)
on delete restrict
on update cascade;
- alter table mm_charitemtable
add foreign key (id) references mm_itemtable (id)
on delete restrict
on update cascade;
- alter table mm_itemitemtable
add foreign key (id) references mm_itemtable (id)
on delete restrict
on update cascade;
- alter table mm_itemattributes
add foreign key (id) references mm_itemtable (id)
on delete restrict
on update cascade;
- alter table mm_roomattributes
add foreign key (id) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_charattributes
add foreign key (charname) references mm_usertable (name)
on delete restrict
on update cascade;
- alter table mm_roomitemtable
add foreign key (room) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_charitemtable
add foreign key (belongsto) references mm_usertable (name)
on delete restrict
on update cascade;
- alter table mm_itemitemtable
add foreign key (containerid) references mm_itemtable (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (north) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (south) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (east) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (west) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (up) references mm_rooms (id)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (down) references mm_rooms (id)
on delete restrict
on update cascade;

- alter table mm_methods
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_commands
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_events
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_items
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_rooms
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_area
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_usertable
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table mm_boards
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- alter table polls add (owner varchar(20), creation timestamp);
- create index owner_index on polls (owner);
- alter table polls
add foreign key (owner) references mm_admin (name)
on delete restrict
on update cascade;
- create index pollid_index on poll_choices (pollid);
- alter table poll_choices
add foreign key (pollid) references polls (id)
on delete restrict
on update cascade;
- alter table poll_values
add foreign key (id) references polls (id)
on delete restrict
on update cascade;
- alter table mm_admin change email email varchar(80) not null;
- alter table mm_admin change passwd passwd varchar(45) not null;
- alter table mm_log drop primary key;
- create index primaryindex on mm_log (creation, name);
- alter table mm_items add (notes text);

creating board system
---------------------
create table mm_boardmessages
(boardid varchar(20) not null,
name varchar(20) not null,
posttime timestamp not null,
message text,
primary key (boardid, name, posttime));

create table mm_boards
(id int not null primary key,
name varchar(80) not null,
description text not null,
owner varchar(20) not null,
creation timestamp not null);
insert into mm_boards values(1, "public", "", "Karn", now());
insert into mm_boards values(2,"logonmessage","","Karn",now());

setting roomitems
-----------------
select concat(
"insert into mm_itemtable (itemid, creation, owner)
values(", id, ",'",  now(), "',null);\n\n",
"insert into mm_roomitemtable (id, room, search)
select id,", room, ", null 
from mm_itemtable 
where id IS NULL;"

)
from mud.tmp_itemtable
where id < 0;

SELECT * FROM tbl_name WHERE auto_col IS NULL

insert into mm_roomitemtable
(id, room, search)
select mm_itemtable.id, tmp.room, null
from mm_itemtable, mud.tmp_itemtable as tmp
where mm_itemtable.itemid = tmp.itemid
amd tmp.room <> 0 
and (tmp.search = null or tmp.search = "");

retrieving someones inventory
-----------------------------
amount multiplied with ...
insert into mm_itemtable
(itemid, creation, owner)
select (id, now(), null)
from mud.tmp_itemtable
where belongsto = ?;

insert into mm_charitemtable
(id, belongsto)
select id, ?
from mm_itemtable
where id > x

bugs
----
create table bugs (title varchar(255) not null, description text, answer
text, closed int(1) default 0, name varchar(20) not null,
creation datetime not null
primary key);

