<html>
<head>
</head>
<body bgcolor="white">

Provides access to the database. All database access must go through this
class, in order to keep database specific code isolated from other parts of
the game.<p>
All database centric methods have "default" package scope, so they can be
used only within this package. All public methods will never return database
objects. This keeps the database part separate from the mud.<P>
All fields that can carry a yes/no or true/false bit are stored as an 
integer containing either 0 (no/false) or 1 (yes/true).<P> 
</PRE>

<H3>List of Database Tables</H3>
<TABLE>
<TR valign=top><TD>Tablename</TD><TD>Description</TD></TR>
<TR valign=top><TD>mm_answers</TD><TD>Contains questions and answers for
bots.</TD></TR>
<TR valign=top><TD>mm_roomattributes</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Attributes of a certain room.</TD></TR>
<TR valign=top><TD>mm_charattributes</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Attributes of a certain character (player/non-player).</TD></TR>
<TR valign=top><TD>mm_itemattributes</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Attributes of a certain item.</TD></TR>
<TR valign=top><TD>mm_logonmessage</TD><TD>The logon message provided upon logon.</TD></TR>

<TR valign=top><TD>mm_sillynamestable</TD><TD></TD></TR>
<TR valign=top><TD>mm_unbantable</TD><TD></TD></TR>
<TR valign=top><TD>mm_bantable</TD><TD></TD></TR>
<TR valign=top><TD>mm_errormessages</TD><TD></TD></TR>
<TR valign=top><TD>mm_help</TD><TD></TD></TR>

<TR valign=top><TD>mm_items</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Provides item definitions. So, basically, if you have 
a bucket, the definition would be in this table, while actual instances of the 
bucket being carried around are in the table mm_itemtable. This table should 
contain characteristics common to all buckets.</TD></TR>
<TR valign=top><TD>mm_shopkeeperitems</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Provides which items a shopkeeper is
allowed to sell/buy and when the shopkeeper decides to stop buying items
from characters (i.e. when the shop has plenty of those specific items in
supply)</TD></TR>
<TR valign=top><TD>mm_itemtable</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Provides instances of item definitions.</TD></TR>
<TR valign=top><TD>mm_charitemtable</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Indicates who is carrying which item instances.</TD></TR>
<TR valign=top><TD>mm_itemitemtable</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Indicates which item instances contain which item instances.</TD></TR>
<TR valign=top><TD>mm_roomitemtable</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Indicates which room contains which item instances </TD></TR>

<TR valign=top><TD>mm_rooms</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Contains room definitions.</TD></TR>
<TR valign=top><TD>mm_area</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Provides an clustering of rooms called an area.
Every room is identified as belonging to a area, the main area being
called "<I>Main</I>".</TD></TR>
<TR valign=top><TD>mm_usertable</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Contains all characters in the game.</TD></TR>
<TR valign=top><TD>mm_mailtable</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Contains mud mail of characters in the game</TD></TR>
<TR valign=top><TD>mm_boards</TD><TD>Identifies individual public message boards,</TD></TR>
<TR valign=top><TD>mm_boardmessages</TD><TD>Contains all messages posted on the public
message boards.</TD></TR>

<TR valign=top><TD>mm_log</TD><TD>Logging table, for describing important events in the
life of characters and administrators.</TD></TR>
<TR valign=top><TD>mm_commandlog</TD><TD>Logging table, contains every
command of every user entered with an appropriate timestamp.</TD></TR>
<TR valign=top><TD>mm_events</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Equal to the linux crontab. Can execute methods
at specific recurring times in the game.</TD></TR>
<TR valign=top><TD>mm_commands</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Special commands that have to be programmed
in methods.</TD></TR>
<TR valign=top><TD>mm_methods</TD><TD><A
HREF="#important"><SUP>(Note)</SUP></A>Special methods that can be entered in the
database to provide characters with special abilities or to be executed
periodically. See related tables mm_commands and mm_events.</TD></TR>
<TR valign=top><TD></TD><TD></TD></TR>
</TABLE>
<A NAME="important"><B>Note</B>: these tables are really really important as
they provide relationships to each other. This effectively means that if
data changes in one table, there is a chance that this will effect data in
another table, especially when regarding the foreign key to primary key
mapping.<P>

<H3>Relationships Between Tables</H3>
<DIV ALIGN="center">
<IMG SRC="/images/jpeg/database_schema.jpg">
<BR>
<I>Figure 1. Relationships between Primary Tables</I><P>
A PDF File can be found <A HREF="/images/pdf/database_schema.pdf">here</A>.
</DIV>
<H3>List of Fields in Each Table</H3>
(<I>* denotes primary key</I>)
</PRE>
<H4>mm_methods</H4>
<DL>
<DT>name
<DD>the name of the method
<DT>src
<DD>the source code of the method in Simkin embedded scripting language
syntax.
<DT>owner
<DD>the owner of the object, i.e. the one that is allowed to make changes.
If this is NULL, the first one to make any changes owns the item.
<DT>creation
<DD>timestamp, is updated with the current datetime 
whenever a change takes place on the record in question.
</DL>
<PRE>
+---------------------+
| mm_methods          |
+---------------------+
|*name                |
| src                 |
| owner               |
| creation            |
+---------------------+
</PRE>
<H4>mm_commands</H4>
<DL>
<DT>id
<DD>identification of the command
<DT>callable
<DD>wether or not the command is active. Either 0 (inactive) or 1 (active).
<DT>command
<DD>the command which triggers this. % as wildcards are permitted.
<DT>method_name
<DD>the name of the method to be executed. Refers to mm_methods.
<DT>room
<DD>the room in which this command might be active. In case of NULL, the
command is activated in <I>all</I> rooms.
<DT>owner
<DD>the owner of the object, i.e. the one that is allowed to make changes.
If this is NULL, the first one to make any changes owns the item.
<DT>creation
<DD>timestamp, is updated with the current datetime 
whenever a change takes place on the record in question.
</DL>
<PRE>
+---------------------+
| mm_commands         |
+---------------------+
|*id                  |
| callable            |
|*command             |
| method_name         |
| room                |
| owner               |
| creation            |
+---------------------+
</PRE>
<H4>mm_events</H4>
<DL>
<DT>eventid
<DD>unique identification of the event.
<DT>name
<DD>name of the character issueing the command. Might be NULL, if it is not
a specific character issueing the action.
<DT>month
<DD>month in which to execute this event. -1 is every month.
<DT>dayofmonth
<DD>dayofmonth in which to execute this event. -1 is every day.
<DT>hour
<DD>hour in which to execute this event. -1 is every hour.
<DT>minute
<DD>minute in which to execute this event. -1 is every minute.
<DT>dayofweek
<DD>dayofweek in which to execute this event. -1 is every dayofweek.
Usually, this value is for if an event should take place once a week on a
specific weekday.
<DT>callable
<DD>wether or not the event is active. Either 0 (inactive) or 1 (active).
<DT>method_name
<DD>the name of the method to be executed. Refers to mm_methods.
<DT>room
<DD>the room in which the event is to take place. Might be NULL, if the
appropriate action to be taken is related to a person and not to a room.
<DT>owner
<DD>the owner of the object, i.e. the one that is allowed to make changes.
If this is NULL, the first one to make any changes owns the item.
<DT>creation
<DD>timestamp, is updated with the current datetime 
whenever a change takes place on the record in question.
</DL>
<PRE>
+---------------------+
| mm_events           |
+---------------------+
|*eventid             |
| name                |
| month               |
| dayofmonth          |
| hour                |
| minute              |
| dayofweek           |
| callable            |
| method_name         |
| room                |
| owner               |
| creation            |
+---------------------+

+---------------------+
| mm_itemattributes   |
+---------------------+
|*name                |
| value               |
| value_type          |
|*id                  |
+---------------------+

+---------------------+
| mm_roomattributes   |
+---------------------+
|*name                |
| value               |
| value_type          |
|*id                  |
+---------------------+

+---------------------+
| mm_charattributes   |
+---------------------+
|*name                |
| value               |
| value_type          |
|*charname            |
+---------------------+

</PRE>
<H4>mm_items</H4>
<DL>
<DT>id
<DD>identification of this item definition, integer.
<DT>wieldable
<DD>no longer used
<DT>wearable
<DD>how this item is to be worn as a bitmask, integer. Values :
1=head,2=neck,4=torso,8=arms,16=leftwrist,32=rightwrist,64=leftfinger,
128=rightfinger,256=feet,512=hands,1024=floating,2048=waist,
4096=legs,8192=eyes,16384=ears,32768=body,65536=wield lefthand,
131072=wield righthand,262144=wielding both hands
<DT>container
<DD>wether or not this item can server as a container for other items.
Possible values are 0 (no container) or 1 (container).
<DT>getable
<DD>wether or not the item can be picked up from the floor. <B>Important:</B> items with a
negative id number, are <I>never</I> getable and are mostly used as
windowdressing for rooms. In this case the field value is ignored by the mud.
<DT>dropable
<DD>wether or not the item can be dropped unto the floor. <B>Important:</B> items with a
negative id number, are <I>never</I> dropable and are mostly used as
windowdressing for rooms. In this case the field value is ignored by the mud.
<DT>visible
<DD>will make the item visible or invisible when in a room or in an
inventory. The default is <I>visible</I>. 
<DT>owner
<DD>the owner of the object, i.e. the one that is allowed to make changes.
If this is NULL, the first one to make any changes owns the item.
<DT>creation
<DD>timestamp, is updated with the current datetime 
whenever a change takes place on the record in question.
</DL>
<PRE>
+---------------------+
| mm_shopkeeperitems  |
+---------------------+
|*id                  |
| max                 |
|*charname            |
+---------------------+

+---------------------+
| mm_itemtable        |
+---------------------+
|*id                  |
| itemid              |
+---------------------+

</PRE>
<H4>mm_charitemtable</H4>
<DL>
<DT>id
<DD>identification of this item instance
<DT>belongsto
<DD>who owns this item instance
<DT>wearing
<DD>are you wearing or wielding the item. wearing==null means that the item
is neither being worn nor wielded.
</DL>
<PRE>
+---------------------+
| mm_charitemtable    |
+---------------------+
|*id                  |
| belongsto           |
| wearing             |
+---------------------+

+---------------------+
| mm_roomitemtable    |
+---------------------+
|*id                  |
| room                |
| search              |
+---------------------+

+---------------------+
| mm_itemitemtable    |
+---------------------+
|*id                  |
| containerid         |
+---------------------+

+---------------------+
| mm_rooms            |
+---------------------+
|*id                  |
| west                |
| east                |
| north               |
| south               |
| up                  |
| down                |
| contents            |
| owner               |
| creation            |
| area                |
+---------------------+

+---------------------+
| mm_area             |
+---------------------+
|*area                |
| description         |
| shortdesc           |
| owner               |
| creation            |
+---------------------+

</PRE>
<H4>mm_usertable</H4>
<DL>
<DT>name
<DD>identification of this character
<DT>race
<DD>The different races are limited in the game. This is because different
races have different implementations and characteristics. 
Possilibities are:
'fox','zombie','wyvern','wolf','turtle','troll','spider','slug','ropegnaw','rabbit','orc','ooze','human','elf','dwarf','duck','deity','chipmunk','buggie','dragon'.
<DT>god
<DD>what this character is, 0=default user, 1=god user (not used currently),
2=bot, 3=mob
<DT>alignment
<DD>the good or evil aspect of a character, 0 is evil, 8 is good, and 
anything in between. The default is 8.
<DT>movementstats
<DD>the ability to move, 0 is exhausted and cannot move, 1000 is fine. The
default is 1000.
</DL>
<PRE>
+---------------------+
| mm_usertable        |
+---------------------+
|*name                |
| god                 |
| alignment           |
| movementstats       |
+---------------------+

+---------------------+
| mm_logonmessage     |
+---------------------+

</PRE>
<H4>mm_commandlog</H4>
<DL>
<DT>stamp
<DD>timestamp of when the command was entered.
<DT>name
<DD>name of the user that entered the command.
<DT>command
<DD>the command entered by the user. Has a maximum of 255 characters. This
limitation 
should not be a problem unless rather large conversations take place.
</DL>
<PRE>
+---------------------+
| mm_commandlog       |
+---------------------+
|*stamp               |
|*name                |
| command             |
+---------------------+

</PRE>
<H4>mm_mailtable</H4>
<DL>
<DT>haveread
<DD>if the mail items has been read or not. (read=1, not read=0)
<DT>newmail
<DD>if the mail is new (i.e. has not been read since the previous
session.
</DL>
<PRE>
+---------------------+
| mm_mailtable        |
+---------------------+
|*name                |
| toname              |
| header              |
|*whensent            |
| haveread            |
| newmail             |
| message             |
+---------------------+

+---------------------+
| mm_sillynamestable  |
+---------------------+

+---------------------+
| mm_unbantable       |
+---------------------+

+---------------------+
| mm_bantable         |
+---------------------+

+---------------------+
| mm_errormessages    |
+---------------------+

+---------------------+
| mm_answers          |
+---------------------+
|*name                |
|*question            |
| answer              |
+---------------------+

+---------------------+
| mm_help             |
+---------------------+

+---------------------+
| mm_log              |
+---------------------+
|*creation            |
|*name                |
| message             |
+---------------------+

+---------------------+
| mm_boards           |
+---------------------+
|*id                  |
| name                |
| description         |
| owner               |
| creation            |
+---------------------+

+---------------------+
| mm_boardmessgages   |
+---------------------+
|*boardid             |
|*name                |
|*posttime            |
| message             |
+---------------------+
</PRE>

The following tables are not related directly to the mud. They are used
mainly for information regarding webside scripts. These tables are easily
recognized because they do not start with the prefix "mm_".<P>
(<I>* denotes primary key</I>)
<TABLE>
<TR valign=top><TD>Tablename</TD><TD>Description</TD></TR>
<TR valign=top><TD>scratchpad</TD><TD>contains personal scratch information
for administration of the game.</TD></TR>
<TR valign=top><TD>characterinfo</TD><TD>contains story information regarding certain
characters.</TD></TR>
<TR valign=top><TD>family</TD><TD>shows the family relations between characters.</TD></TR>
<TR valign=top><TD>familyvalues</TD><TD>provides a number of possible family relations.
</TD></TR>
<TR valign=top><TD>polls</TD><TD>contains the different polls.</TD></TR>
<TR valign=top><TD>poll_choices</TD><TD>contains the possible choices per poll.
</TD></TR>
<TR valign=top><TD>poll_values</TD><TD>contains the answers of users to the different
polls.</TD></TR>
<TR valign=top><TD></TD><TD></TD></TR>
</TABLE>
<PRE>
+---------------------+
| scratchpad          |
+---------------------+
|*id                  |
| scratch             |
+---------------------+

+---------------------+
| characterinfo       |
+---------------------+
|*name                |
| imageurl            |
| homepageurl         |
| dateofbirth         |
| cityofbirth         |
| storyline           |
+---------------------+

+---------------------+
| family              |
+---------------------+
|*name                |
|*toname              |
| description         |
+---------------------+

+---------------------+
| familyvalues        |
+---------------------+
|*id                  |
| description         |
+---------------------+

+---------------------+
| polls               |
+---------------------+
|*id                  |
| title               |
| description         |
| closed              |
+---------------------+

+---------------------+
| poll_choices        |
+---------------------+
|*id                  |
|*pollid              |
| choice              |
+---------------------+

+---------------------+
| poll_values         |
+---------------------+
|*id                  |
|*name                |
| value               |
| comments            |
+---------------------+
</PRE>

</body>
</html>
