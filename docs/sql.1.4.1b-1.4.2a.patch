#!/bin/sh

/usr/bin/mysql --password=pagedown -s mud <<END_OF_DATA
#
# create a patch for the new version of the mud
#

#
# Alter the Items table in order to put in a new field called "pasdefense"
# This is necessary in order to make the calculations during defense of a
# person during combat.
#
# armour - 1..6 points
# shields - 1..4 points
#
ALTER TABLE items ADD pasdefense int(2), damageresistance int(2);
UPDATE items SET pasdefense = 0, damageresistance = 0;

#
# add the tables "skills" and "skilltable"
#
CREATE TABLE skills (
	id int(4) DEFAULT 0 NOT NULL,
	name varchar(20),
	inlevel int(5),
	outlevel int(5),
	manacost int(5),
	begineffect blob,
	endeffect blob,
	modifiername int(2),
	difficulty int(2),
	type int(2),
	activedefense int(1),
	primary key (id));

insert into skills values(0,'barehand combat', 0, 100000, 0, '', '', 0, 0, 0);
insert into skills values(1,'pick fighting', 0, 10, 0, '', '', 0, 0, 0);
insert into skills values(2,'knife fighting', 0, 10, 0, '', '', 0, 0, 0);

CREATE TABLE skilltable (
	id int(4) DEFAULT 0 NOT NULL,
	forwhom varchar(20) NOT NULL,
	skilllevel int(5),
	primary key (id, forwhom));

# defense of black, leather jerkin
update items set pasdefense=4 where id=25;

# something to think about
alter table usertable change race race enum("fox", "zombie","wyvern","wolf","turtle","troll","spider","slug","ropegnaw","rabbit","orc","ooze","human","elf","dwarf","duck","deity","chipmunk","buggie");
update usertable set race = "human" where race = "";
alter table tmp_usertable change race race enum("fox", "zombie","wyvern","wolf","turtle","troll","spider","slug","ropegnaw","rabbit","orc","ooze","human","elf","dwarf","duck","deity","chipmunk","buggie");
update tmp_usertable set race = "human" where race = "";
alter table bottable change race race enum("fox", "zombie","wyvern","wolf","turtle","troll","spider","slug","ropegnaw","rabbit","orc","ooze","human","elf","dwarf","duck","deity","chipmunk","buggie");
update bottable set race = "human" where race = "";
alter table olduser change race race enum("fox", "zombie","wyvern","wolf","turtle","troll","spider","slug","ropegnaw","rabbit","orc","ooze","human","elf","dwarf","duck","deity","chipmunk","buggie");
update olduser set race = "human" where race = "";

alter table usertable change sex sex enum("male", "female");
update usertable set sex = "male" where sex = "";
alter table tmp_usertable change sex sex enum("male", "female");
update tmp_usertable set sex = "male" where sex = "";
alter table bottable change sex sex enum("male", "female");
update bottable set sex = "male" where sex = "";
alter table olduser change sex sex enum("male", "female");
update olduser set sex = "male" where sex = "";

# add comments to the different table that are used by the game
ALTER TABLE bogus_itemtable comment = 'a temporary table for the cleaning up of corpses in the game(mysql_healing)';
ALTER TABLE action comment = 'descriptions of special actions that are allowed in some room';
ALTER TABLE answers comment = 'the different answers by bots on questions asked';
ALTER TABLE bantable comment = 'who is banned, why, by whom, for how long at which time';
ALTER TABLE bottable comment = 'the bots, gets copied periodically to the tmp_usertable';
ALTER TABLE bugreportlist comment = 'list of bugs still to be solved';
ALTER TABLE depalias comment = 'special commands for the deputies to use';
ALTER TABLE help comment = 'help on commands';
ALTER TABLE items comment = 'item definitions';
ALTER TABLE itemtable comment = 'all items';
ALTER TABLE logonmessage comment = 'the logonmessage when you enter the game';
ALTER TABLE mailtable comment = 'all mail';
ALTER TABLE olditem comment = 'archived/deleted items';
ALTER TABLE oldmail comment = 'archived/deleted mail';
ALTER TABLE olduser comment = 'archived/deleted users';
ALTER TABLE respawningitemtable comment = 'items that need to reappear after a certain time';
ALTER TABLE rooms comment = 'description of all rooms, along with exits';
ALTER TABLE sillynamestable comment = 'silly names/bad language in order to root out bad logonids in entering the game';
ALTER TABLE skills comment = 'skill definitions';
ALTER TABLE skilltable comment = 'all skills';
ALTER TABLE tmp_itemtable comment = 'items during gameplay';
ALTER TABLE tmp_mailtable comment = 'mail during gameplay';
ALTER TABLE tmp_usertable comment = 'users during gameplay';
ALTER TABLE unbantable comment = '}people that are allowed to login despite that their site/domain is banned';
ALTER TABLE usertable comment = 'all users';

END_OF_DATA

