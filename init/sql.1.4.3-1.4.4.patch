#!/bin/sh

/usr/bin/mysql --user=mmud --password=itsasecret mmud <<END_OF_DATA
#
# create a patch for the new version of the mud
#

create table boards 
(
boardname varchar(20) NOT NULL default 'public',
name varchar(20) NOT NULL default '',
posttime datetime NOT NULL,
message text NOT NULL,
primary key (boardname, name, posttime)
);

alter table tmp_itemtable 
add (containerid int default 0 not null);

alter table tmp_itemtable drop primary key;
alter table tmp_itemtable add primary key (id, search, belongsto, room ,
wearing, wielding, containerid);

alter table itemtable
add (containerid int default 0 not null);

alter table itemtable drop primary key;
alter table itemtable add primary key (id, search, belongsto, room ,
wearing, wielding, containerid);

alter table bogus_itemtable
add (containerid int default 0 not null);

alter table bogus_itemtable drop primary key;
alter table bogus_itemtable add primary key (id, search, belongsto, room ,
wearing, wielding, containerid);

alter table olditem
add (containerid int default 0 not null);

alter table olditem drop primary key;
alter table olditem add primary key (id, search, belongsto, room ,
wearing, wielding, containerid);

alter table respawningitemtable
add (containerid int default 0 not null);

alter table respawningitemtable drop primary key;
alter table respawningitemtable add primary key (id, search, belongsto, room ,
wearing, wielding, containerid);

create table containeditems (id int(7) not null,
/*search = ''*/
/*not necessary because inherited from parent... 
belongsto varchar(20) not null,*/
amount int(7),
/*room int(7) default 0,*/
/*wearing
wielding*/
containedin int(11) not null,
primary key (id, containedin));

alter table items
add (container int default 0 not null); /* specify weight in units, 0=no
container */

alter table bottable change race race 
enum('fox','zombie','wyvern','wolf','turtle','troll','spider','slug',
'ropegnaw','rabbit','orc','ooze','human','elf','dwarf','duck','deity',
'chipmunk','buggie','dragon') default NULL, 
change sex sex enum('male','female') default
NULL;
alter table olduser change race race 
enum('fox','zombie','wyvern','wolf','turtle','troll','spider','slug',
'ropegnaw','rabbit','orc','ooze','human','elf','dwarf','duck','deity',
'chipmunk','buggie','dragon') default NULL, 
change sex sex enum('male','female') default
NULL;
alter table tmp_usertable change race race 
enum('fox','zombie','wyvern','wolf','turtle','troll','spider','slug',
'ropegnaw','rabbit','orc','ooze','human','elf','dwarf','duck','deity',
'chipmunk','buggie','dragon') default NULL, 
change sex sex enum('male','female') default
NULL;
alter table usertable change race race 
enum('fox','zombie','wyvern','wolf','turtle','troll','spider','slug',
'ropegnaw','rabbit','orc','ooze','human','elf','dwarf','duck','deity',
'chipmunk','buggie','dragon') default NULL, 
change sex sex enum('male','female') default
NULL;

#
# Table structure for table 'tmp_attributes'
select "" as "Creating 'tmp_attributes' table...";
CREATE TABLE tmp_attributes (
  name varchar(32) NOT NULL default '',
  value text,
  value_type varchar(20) NOT NULL default 'string',
  objectid varchar(200) NOT NULL default '0',
  objecttype int(3) NOT NULL default '0',
  PRIMARY KEY  (name,objectid,objecttype)
) TYPE=MyISAM;

END_OF_DATA

